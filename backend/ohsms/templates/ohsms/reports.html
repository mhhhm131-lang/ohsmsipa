{% load static %}


<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>OHSMS โ ูุธุงู ุงูุจูุงุบุงุช / ุณุฌู ุงููุชุงุจุนุฉ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="stylesheet" href="{% static 'assets/css/styles.css' %}">
 
</head>
<body>
<header class="top-header">
  <h1>ูุธุงู ุฅุฏุงุฑุฉ ุงูุณูุงูุฉ ูุงูุตุญุฉ ุงูููููุฉ โ OHSMS</h1>
  <p>ูุธุงู ุงูุจูุงุบุงุช โ ุณุฌู ุงูุจูุงุบุงุช ููุณุงุฑ ุงููุนุงูุฌุฉ (Workflow)</p>
</header>

<div class="main-wrapper">
      
   <aside class="sidebar">
<h3>ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ</h3>
<a class="nav-link" href="{% url 'home' %}" data-perm="view_home">ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
<a class="nav-link" href="{% url 'reports' %}" data-perm="view_reports">ูุธุงู ุงูุจูุงุบุงุช / ุณุฌู ุงููุชุงุจุนุฉ</a>
<a class="nav-link" href="{% url 'risk' %}" data-perm="view_risks">ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ</a>

<a class="nav-link" href="awareness.html" data-perm="view_awareness">ุงูุชูุนูุฉ ูุงูุชุซููู</a>
<a class="nav-link" href="vendors.html" data-perm="view_partners">ุงูุนููุงุก ูุงูุดุฑูุงุก</a>
<a class="nav-link" href="{% url 'forms' %}" data-perm="view_forms">ุงูููุงุฐุฌ ุงูุฑูููุฉ</a>
<a class="nav-link" href="{% url 'dashboard' %}" data-perm="view_dashboard">ููุญุฉ ุงูุชุญูู</a>
<a class="nav-link" href="{% url 'system' %}" data-perm="view_system">ุฅุฏุงุฑุฉ ุงููุธุงู</a>

</aside>



  <main class="content">
    <section class="card">
      <h2><span class="emoji">๐</span>ุณุฌู ุงูุจูุงุบุงุช</h2>
      <p class="hint">ูุชู ุนุฑุถ ุฌููุน ุงูุจูุงุบุงุช ุงูุชู ุชู ุฅุฏุฎุงููุง ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุน ุญุงูุฉ ูู ุจูุงุบ.</p>
      <div id="reports-table"></div>
    </section>

    <section class="card">
      <h2><span class="emoji">๐ข</span>ุงููุณุงุฑ ุงูุนุงู ููุนุงูุฌุฉ ุงูุจูุงุบ</h2>
      <p class="hint">ููุซู ูุฐุง ุงููุฎุทุท ุงููุฑุงุญู ุงูููุงุณูุฉ ููุนุงูุฌุฉ ุงูุจูุงุบุงุช. ูุชู ุชุญุฏูุซ ุญุงูุฉ ูู ุจูุงุบ ูู ุฎูุงู ูุงูุฐุฉ "ุฅุฏุงุฑุฉ ุงูุจูุงุบ".</p>
      <div id="timeline-global" class="timeline-container"></div>
    </section>
  </main>
</div>

<!-- ูุงูุฐุฉ ุฅุฏุงุฑุฉ ุงูุจูุงุบ -->
<div id="reportModal" class="modal hidden">
  <div class="modal-box wide">
    <h3>ุฅุฏุงุฑุฉ ุงูุจูุงุบ</h3>
    <p class="modal-hint">ุงุณุชุนุฑุงุถ ุชูุงุตูู ุงูุจูุงุบ ูุชุญุฏูุซ ูุณุงุฑ ุงููุนุงูุฌุฉ (ุงุณุชูุงูุ ุฅุญุงูุฉุ ุชุญูููุ ุชูููุฐุ ุชุตุนูุฏุ ุฅุบูุงู).</p>

  <div class="info-cards">

  <div class="info-card">
    <div class="ic-icon">๐</div>
    <div class="ic-title">ุฑูู ุงูุจูุงุบ</div>
    <div class="ic-value" id="infoId">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐ท๏ธ</div>
    <div class="ic-title">ููุน ุงูุจูุงุบ</div>
    <div class="ic-value" id="infoType">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐</div>
    <div class="ic-title">ุชุงุฑูุฎ ุงูุฅุฏุฎุงู</div>
    <div class="ic-value" id="infoCreated">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐</div>
    <div class="ic-title">ุงููููุน</div>
    <div class="ic-value" id="infoLocation">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐</div>
    <div class="ic-title">ููุงุฉ ุงูุชูุงุตู</div>
    <div class="ic-value" id="infoContact">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐ค</div>
    <div class="ic-title">ุงุณู ุงููุจูุบ</div>
    <div class="ic-value" id="infoName">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">โ๏ธ</div>
    <div class="ic-title">ููุน ุงูุฎุทุฑ</div>
    <div class="ic-value" id="infoDanger">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐ทโโ๏ธ</div>
    <div class="ic-title">ุงุณุชูุงู ุจูุงุณุทุฉ</div>
    <div class="ic-value" id="infoReceivedBy">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">โฑ๏ธ</div>
    <div class="ic-title">ููุช ุงูุงุณุชูุงู</div>
    <div class="ic-value" id="infoReceivedAt">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐ข</div>
    <div class="ic-title">ุงูุฅุญุงูุฉ ููุฅุฏุงุฑุฉ</div>
    <div class="ic-value" id="infoAssignedDept">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐ค</div>
    <div class="ic-title">ุงุณู ููุณู ุงูุณูุงูุฉ</div>
    <div class="ic-value" id="infoCoordinator">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">โฑ๏ธ</div>
    <div class="ic-title">ููุช ุงูุฅุญุงูุฉ</div>
    <div class="ic-value" id="infoAssignedAt">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">๐ง</div>
    <div class="ic-title">ุงูููุธู ุงููููุฐ ููุฅุฌุฑุงุก</div>
    <div class="ic-value" id="infoExecutor">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">โก๏ธ</div>
    <div class="ic-title">ููุช ุชุญููู ุงูุชูููุฐ</div>
    <div class="ic-value" id="infoForwardedAt">-</div>
  </div>

  <div class="info-card">
    <div class="ic-icon">โ๏ธ</div>
    <div class="ic-title">ููุช ุชูููุฐ ุงูุฅุฌุฑุงุก</div>
    <div class="ic-value" id="infoDoneAt">-</div>
  </div>

</div>
 



<div class="info-block">
  <div class="info-label">ูุต ุงูุจูุงุบ:</div>
  <div class="info-value" id="infoDesc"></div>
</div>

<div class="info-block">
  <div class="info-label">ููุงุฉ ุงูุชูุงุตู:</div>
  <div class="info-value" id="infoContact"></div>
</div>


    <div class="info-block">
      <div class="info-label">ูุต ุงูุจูุงุบ ุงูุฃุตูู:</div>
      <div class="info-value" id="infoDesc"></div>
    </div
><!-- ุงูุฎุท ุงูุฒููู ุงูุฌุฏูุฏ ุจุดูู ุฏูุงุฆุฑ -->
<div class="timeline-container">
  <h4 class="info-label" style="margin-top:10px;margin-bottom:6px;">
    ูุณุงุฑ ูุนุงูุฌุฉ ูุฐุง ุงูุจูุงุบ:
  </h4>

  <div id="timeline-modal" class="timeline-wrapper">
    <!-- ูุชู ุชุนุจุฆุชู ุจุงููุงูู ูู reports.js / buildTimeline -->
  </div>
</div>
<!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช ุงูุซุงูููุฉ (ุงูุชุตุนูุฏ + ุงูุชูุงุตู) -->
<div class="action-card">

  <h4>ุฅุฌุฑุงุกุงุช ุฅุถุงููุฉ</h4>

  <div class="action-buttons">

    <button class="btn-escalate2" onclick="actionEscalate()">
        โ๏ธ ุชุตุนูุฏ ุงูุจูุงุบ
    </button>

    <button class="btn-contact2" onclick="actionContact()">
        ๐ ุงูุชูุงุตู ูุน ุงููุจููุบ
    </button>

  </div>

</div>





    <div class="info-block">
      <div class="info-label">ุชุนููู / ููุงุญุธุงุช ุงููุฑุญูุฉ (ุญุฏ ุชูุฑูุจู 75 ูููุฉ):</div>
      <textarea id="commentBox" class="textarea" placeholder="ูููู ูุชุงุจุฉ ููุฎุต ุงูุฅุฌุฑุงุก ุฃู ุณุจุจ ุงูุฅุญุงูุฉ / ุงูุชุตุนูุฏ / ุงูุฅุบูุงู."></textarea>
      <div id="historyBox" class="history-box"></div>
    </div>

    <div class="actions-row" style="margin-top:10px;display:flex;flex-wrap:wrap;gap:6px;">
      <button class="btn btn-small btn-receive" onclick="actionReceive()">๐ฅ ุงุณุชูุงู</button>
      <button class="btn btn-small btn-assign" onclick="actionAssign()">๐ค ุฅุญุงูุฉ</button>
      <button class="btn btn-small btn-forward" onclick="actionForward()">๐ ุชุญููู ููููุฏุงูู</button>
      <button class="btn btn-small btn-done" onclick="actionDone()">โ ุชู ุชูููุฐ ุงูุฅุฌุฑุงุก</button>
      <button class="btn btn-small btn-escalate" onclick="actionEscalate()">โ๏ธ ุชุตุนูุฏ</button>
      <button class="btn btn-small btn-close" onclick="actionCloseCase()">๐ ุฅุบูุงู ุงูุจูุงุบ</button>
      <button class="btn btn-small btn-contact" onclick="actionContact()">๐ ุงูุชูุงุตู ูุน ุงููุจููุบ</button>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeReportModal()">ุฅุบูุงู ุงููุงูุฐุฉ</button>
    </div>
  </div>
</div>


<script src="{% static 'assets/js/common.js' %}"></script>
<script src="{% static 'assets/js/system.js' %}"></script>

<script src="{% static 'assets/js/system.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {

    const user = ohsmsGetCurrentUser();
if(!user){
    alert("ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู");
    location.href = "{% url 'login' %}";
    return;
}


    if(!ohsmsHasPermission("view_reports")){
        alert("ุบูุฑ ูุตุฑุญ ูู ุจุงูุฏุฎูู ุฅูู ุณุฌู ุงููุชุงุจุนุฉ");
        location.href = "index.html";
        return;
    }
});
</script>
<div id="assignModal" class="modal hidden">
  <div class="modal-box">
    <h3>ุฅุญุงูุฉ ุงูุจูุงุบ</h3>

    <label>ุงูุฅุฏุงุฑุฉ ุงููุญุงู ุฅูููุง</label>
    <input id="assignDept" class="input" placeholder="ูุซุงู: ุฅุฏุงุฑุฉ ุงูุตูุงูุฉ">

    <label>ุงุณู ููุณู ุงูุณูุงูุฉ</label>
    <input id="assignCoord" class="input" placeholder="ูุซุงู: ูุญูุฏ ุงูุนุชูุจู">

    <label>ููุงุญุธุงุช (ุงุฎุชูุงุฑู)</label>
    <textarea id="assignNote" class="textarea"></textarea>

    <div class="modal-actions">
      <button class="btn btn-primary" onclick="saveAssign()">ุญูุธ ุงูุฅุญุงูุฉ</button>
      <button class="btn btn-secondary" onclick="closeAssignModal()">ุฅูุบุงุก</button>
    </div>
  </div>
</div>

<!-- ูุงูุฐุฉ ููุงุญุธุงุช ุงููุฑุญูุฉ ูู ุงูุชุงูููุงูู -->
<div id="stepNoteModal" class="modal hidden">
  <div class="modal-box">

    <h3>ููุงุญุธุงุช ุงููุฑุญูุฉ</h3>

    <textarea id="stepNoteInput" placeholder="ุฃุถู ููุงุญุธุงุชู ุญูู ูุฐู ุงููุฑุญูุฉ..."></textarea>

    <div style="display:flex; gap:10px; margin-top:15px;">
        <button id="saveStepNoteBtn" class="save-note-btn">๐พ ุญูุธ</button>
        <button class="close-note-btn" onclick="closeStepNoteModal()">ุฅุบูุงู</button>
    </div>

  </div>
</div>

</div>
<!-- ูุงูุฐุฉ ููุงุญุธุงุช ุงููุฑุญูุฉ -->
<div id="stepNoteModal" class="modal hidden">
  <div class="modal-box">
    <h3 id="stepNoteTitle">ููุงุญุธุงุช ุงููุฑุญูุฉ</h3>

    <textarea
      id="stepNoteTextarea"
      class="textarea"
      placeholder="ุงูุชุจ ููุงุญุธุงุช ูุฐู ุงููุฑุญูุฉ ููุง..."
      style="min-height:120px"
    ></textarea>

    <div class="modal-actions">
      <button class="btn btn-primary" onclick="saveStepNote()">ุญูุธ</button>
      <button class="btn btn-secondary" onclick="closeStepNoteModal()">ุฅูุบุงุก</button>
    </div>
  </div>
</div>


</body>

</html>