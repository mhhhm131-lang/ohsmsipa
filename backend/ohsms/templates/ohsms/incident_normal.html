<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨Ù„Ø§Øº Ø¹Ø§Ø¯ÙŠ</title>
</head>
<body>

{% if not user.is_authenticated %}

    <h2>ğŸ“„ Ø¨Ù„Ø§Øº Ø¹Ø§Ø¯ÙŠ</h2>

    <p>Ù‡Ø°Ù‡ ØµÙØ­Ø© Ø§Ù„Ø¨Ù„Ø§Øº Ø§Ù„Ø¹Ø§Ø¯ÙŠ â€“ Ù„Ø§ ØªØ¸Ù‡Ø± Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>

    <a href="{% url 'login' %}?next={{ request.path }}">
        ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    </a>

    <br><br>
    <a href="/">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

{% else %}

    <h2>ğŸ“„ Ø¨Ù„Ø§Øº Ø¹Ø§Ø¯ÙŠ</h2>
    <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ user.username }} ğŸ‘‹</p>

    <form method="post">
        {% csrf_token %}

        <!-- Ø§Ù„ÙØ±Ø¹ -->
        <label>Ø§Ù„ÙØ±Ø¹:</label><br>
        <select id="branch" name="branch">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹</option>
            {% for branch in branches %}
                <option value="{{ branch.id }}">{{ branch.name }}</option>
            {% endfor %}
        </select>

        <br><br>

        <!-- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
        <label>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</label><br>
        <select id="department" name="department">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
        </select>

        <br><br>

        <!-- Ø§Ù„Ù‚Ø³Ù… -->
        <label>Ø§Ù„Ù‚Ø³Ù…:</label><br>
        <select id="section" name="section">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
        </select>

        <br><br>

        <button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº</button>
    </form>

    <br>
    <a href="/">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

{% endif %}

<script>
document.getElementById("branch")?.addEventListener("change", function () {
    const branchId = this.value;
    const departmentSelect = document.getElementById("department");
    const sectionSelect = document.getElementById("section");

    departmentSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>';
    sectionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';

    if (!branchId) return;

    fetch(`/ajax/departments/?branch_id=${branchId}`)
        .then(response => response.json())
        .then(data => {
            data.forEach(dept => {
                const option = document.createElement("option");
                option.value = dept.id;
                option.textContent = dept.name;
                departmentSelect.appendChild(option);
            });
        });
});

document.getElementById("department")?.addEventListener("change", function () {
    const departmentId = this.value;
    const sectionSelect = document.getElementById("section");

    sectionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';

    if (!departmentId) return;

    fetch(`/ajax/sections/?department_id=${departmentId}`)
        .then(response => response.json())
        .then(data => {
            data.forEach(sec => {
                const option = document.createElement("option");
                option.value = sec.id;
                option.textContent = sec.name;
                sectionSelect.appendChild(option);
            });
        });
});
</script>

</body>
</html>
