<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>متابعة البلاغ السري</title>
</head>
<body>

<h2>متابعة البلاغ السري</h2>

<form method="post">
    {% csrf_token %}
    <label>مفتاح المتابعة:</label><br>
    <input type="text" name="secret_key" required>
    <button type="submit">متابعة</button>
</form>

{% if error %}
    <p style="color:red;">{{ error }}</p>
{% endif %}

{% if incident %}
    <hr>
    <h3>تفاصيل البلاغ</h3>
    <p><strong>رقم البلاغ:</strong> {{ incident.number }}</p>
    <p><strong>الحالة الحالية:</strong> {{ incident.get_status_display }}</p>
    <p><strong>تاريخ الإنشاء:</strong> {{ incident.created_at }}</p>

    <hr>
    {% if closed %}
<p style="color:red;">هذا البلاغ مغلق ولا يمكن متابعته أو التفاعل معه.</p>
{% endif %}

    <h3>سجل المعالجة</h3>
    <ul>
        {% for event in incident.events.all %}
            <li>
                {{ event.created_at }} — {{ event.get_action_display }} — {{ event.note }}
            </li>
        {% empty %}
            <li>لا توجد تحديثات بعد.</li>
        {% endfor %}
    </ul>
{% endif %}

</body>
</html>
