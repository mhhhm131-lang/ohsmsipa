<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨Ù„Ø§Øº Ø³Ø±ÙŠ</title>
</head>
<body>

<h2>ğŸ”’ Ø¨Ù„Ø§Øº Ø³Ø±ÙŠ</h2>

<p>
    ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ‚Ø¯ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø§Øº Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ØŒ ÙˆÙ„Ù† ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ©.
</p>

{% if success %}
    <p style="color: green;">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº Ø¨Ù†Ø¬Ø§Ø­</p>
{% endif %}

<form method="post">
    {% csrf_token %}

    <!-- Ø§Ù„ÙØ±Ø¹ -->
    <label>Ø§Ù„ÙØ±Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label><br>
    <select id="branch" name="branch">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹</option>
        {% for branch in branches %}
            <option value="{{ branch.id }}">{{ branch.name }}</option>
        {% endfor %}
    </select>

    <br><br>

    <!-- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
    <label>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label><br>
    <select id="department" name="department">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
    </select>

    <br><br>

    <!-- Ø§Ù„Ù‚Ø³Ù… -->
    <label>Ø§Ù„Ù‚Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label><br>
    <select id="section" name="section">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
    </select>

    <br><br>

    <button type="submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº Ø§Ù„Ø³Ø±ÙŠ</button>
</form>

<br>
<a href="/">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

<script>
document.getElementById("branch")?.addEventListener("change", function () {
    const branchId = this.value;
    const departmentSelect = document.getElementById("department");
    const sectionSelect = document.getElementById("section");

    departmentSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>';
    sectionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';

    if (!branchId) return;

    fetch(`/ajax/departments/?branch_id=${branchId}`)
        .then(res => res.json())
        .then(data => {
            data.forEach(d => {
                const o = document.createElement("option");
                o.value = d.id;
                o.textContent = d.name;
                departmentSelect.appendChild(o);
            });
        });
});

document.getElementById("department")?.addEventListener("change", function () {
    const departmentId = this.value;
    const sectionSelect = document.getElementById("section");

    sectionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';

    if (!departmentId) return;

    fetch(`/ajax/sections/?department_id=${departmentId}`)
        .then(res => res.json())
        .then(data => {
            data.forEach(s => {
                const o = document.createElement("option");
                o.value = s.id;
                o.textContent = s.name;
                sectionSelect.appendChild(o);
            });
        });
});
</script>

</body>
</html>
